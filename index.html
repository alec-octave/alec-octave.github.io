<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Lunch Wheel</title>
  <link rel="stylesheet" href="./styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Background grid and twinkles -->
  <div class="bg-grid"></div>
  <div class="star s1"></div>
  <div class="star s2"></div>
  <div class="star s3"></div>
  <div class="star s4"></div>
  <div class="star s5"></div>
  <div class="app">
    <h1>Octave Lunch Wheel of Destiny</h1>

    <div class="wheel-wrap">
      <div class="pointer" aria-hidden="true"></div>
      <canvas id="wheel" width="680" height="680" aria-label="Lunch picker wheel"></canvas>
    </div>

    <div id="winner" class="winner" role="status" aria-live="polite" style="display: none;"></div>
    <div class="controls">
      <button id="spinBtn" class="primary">Spin</button>
      <button id="respinsBtn" class="ghost" title="Spin again without changing weights">Respin</button>
      <button id="shareToSlackBtn" class="ghost" style="display: none;" title="Share result to Slack">Share to Slack</button>
      <!-- TEST BUTTON - Comment out when done testing -->
      <!-- <button id="testImageUploadBtn" class="ghost" style="background: rgba(255, 165, 0, 0.2); border-color: orange;" title="Test image upload">üß™ Test Image Upload</button> -->
    </div>

    <div id="confetti" class="confetti" aria-hidden="true"></div>

    <details class="items">
      <summary>Show items and probabilities</summary>
      <div class="editor-controls">
        <button id="addItemBtn" class="ghost" title="Add a restaurant">Add Restaurant</button>
        <button id="resetWeightsBtn" class="ghost" title="Reset to original data">Reset</button>
        <span class="hint">Weights must sum to 1. Changes auto-redistribute.</span>
      </div>
      <div id="itemsList"></div>
    </details>

    <details class="items" id="settingsSection">
      <summary>‚öôÔ∏è Settings</summary>
      <div style="padding: 16px;">
        <label for="githubTokenInput" style="display: block; margin-bottom: 8px; color: var(--neon); font-weight: 600;">
          GitHub Token (for ledger sync)
        </label>
        <input
          type="password"
          id="githubTokenInput"
          placeholder="Enter your GitHub Personal Access Token"
          style="width: 100%; padding: 8px; background: rgba(0,0,0,0.6); border: 1px solid rgba(0,255,255,0.3); color: var(--text); font-family: monospace; margin-bottom: 8px;"
        />
        <p style="font-size: 12px; color: var(--muted); margin: 8px 0;">
          Add your GitHub token to sync spins to the shared ledger.
          <a href="https://github.com/settings/tokens" target="_blank" style="color: var(--neon);">Get token here</a>
          (needs "repo" scope or fine-grained with "Contents: Write" for this repo).
        </p>
        <button id="saveTokenBtn" class="ghost" style="margin-top: 8px;">Save Token</button>
        <button id="testTokenBtn" class="ghost" style="margin-top: 8px; margin-left: 8px;">Test Token</button>
        <button id="clearTokenBtn" class="ghost" style="margin-top: 8px; margin-left: 8px;">Clear Token</button>
        <div id="tokenStatus" style="margin-top: 8px; font-size: 12px;"></div>
      </div>
    </details>

    <details class="items" id="lunchLedger">
      <summary>Lunch Ledger</summary>
      <div id="ledgerContent">
        <div id="ledgerTable"></div>
        <div class="charts-container">
          <div class="chart-wrapper">
            <h3>Top Winners (Last 30 Days)</h3>
            <canvas id="histogramChart"></canvas>
          </div>
          <div class="chart-wrapper">
            <h3>Distribution</h3>
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
    </details>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- GitHub token is now managed via Settings UI and stored in localStorage -->
  <!-- No need to hardcode tokens in the repo -->
  <!-- Set your Cloudinary credentials here for image uploads -->
  <!-- Cloud name from your account -->
  <script>window.CLOUDINARY_CLOUD_NAME = 'dr8wfog1s';</script>
  <!-- Create an unsigned upload preset in Cloudinary Dashboard: Settings > Upload > Upload presets -->
  <!-- Then set the preset name here (e.g., 'ml_default' or whatever you name it) -->
  <!-- https://console.cloudinary.com/app/c-18e4d21ca6a68c0b5c3750cf57b926/settings/upload/presets -->
  <script>window.CLOUDINARY_UPLOAD_PRESET = 'octave_wheel';</script>
  <script src="./wheel.js" type="module"></script>

  <!-- 80s floating rings -->
  <div class="floating-ring ring-1"></div>
  <div class="floating-ring ring-2"></div>
  <div class="floating-ring ring-3"></div>
  <div class="floating-ring ring-4"></div>
  <div class="floating-ring ring-5"></div>

  <!-- Geometric shapes -->
  <div class="shape tri p-tl-1"></div>
  <div class="shape bar p-tl-2"></div>
  <div class="shape bolt p-tr-1"></div>
  <div class="shape orb p-tr-2"></div>
  <div class="shape tri grad p-bl-1"></div>
  <div class="shape bar p-br-1"></div>

  <!-- Octave logos in corners -->
  <div class="octave-logo logo-tl">
    <svg viewBox="0 0 40 40" width="40" height="40">
      <defs>
        <radialGradient id="grad1" cx="50%" cy="50%" r="50%">
          <stop offset="0%" style="stop-color:#1a0b2e;stop-opacity:1" />
          <stop offset="30%" style="stop-color:#6b46c1;stop-opacity:1" />
          <stop offset="60%" style="stop-color:#3b82f6;stop-opacity:1" />
          <stop offset="80%" style="stop-color:#06b6d4;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
        </radialGradient>
      </defs>
      <circle cx="20" cy="20" r="18" fill="url(#grad1)" />
      <polygon points="20,8 24,16 32,16 26,22 28,30 20,26 12,30 14,22 8,16 16,16" fill="#ffffff" />
    </svg>
  </div>
  <div class="octave-logo logo-tr">
    <svg viewBox="0 0 40 40" width="40" height="40">
      <defs>
        <radialGradient id="grad2" cx="50%" cy="50%" r="50%">
          <stop offset="0%" style="stop-color:#1a0b2e;stop-opacity:1" />
          <stop offset="30%" style="stop-color:#6b46c1;stop-opacity:1" />
          <stop offset="60%" style="stop-color:#3b82f6;stop-opacity:1" />
          <stop offset="80%" style="stop-color:#06b6d4;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
        </radialGradient>
      </defs>
      <circle cx="20" cy="20" r="18" fill="url(#grad2)" />
      <polygon points="20,8 24,16 32,16 26,22 28,30 20,26 12,30 14,22 8,16 16,16" fill="#ffffff" />
    </svg>
  </div>
  <div class="octave-logo logo-bl">
    <svg viewBox="0 0 40 40" width="40" height="40">
      <defs>
        <radialGradient id="grad3" cx="50%" cy="50%" r="50%">
          <stop offset="0%" style="stop-color:#1a0b2e;stop-opacity:1" />
          <stop offset="30%" style="stop-color:#6b46c1;stop-opacity:1" />
          <stop offset="60%" style="stop-color:#3b82f6;stop-opacity:1" />
          <stop offset="80%" style="stop-color:#06b6d4;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
        </radialGradient>
      </defs>
      <circle cx="20" cy="20" r="18" fill="url(#grad3)" />
      <polygon points="20,8 24,16 32,16 26,22 28,30 20,26 12,30 14,22 8,16 16,16" fill="#ffffff" />
    </svg>
  </div>
  <div class="octave-logo logo-br">
    <svg viewBox="0 0 40 40" width="40" height="40">
      <defs>
        <radialGradient id="grad4" cx="50%" cy="50%" r="50%">
          <stop offset="0%" style="stop-color:#1a0b2e;stop-opacity:1" />
          <stop offset="30%" style="stop-color:#6b46c1;stop-opacity:1" />
          <stop offset="60%" style="stop-color:#3b82f6;stop-opacity:1" />
          <stop offset="80%" style="stop-color:#06b6d4;stop-opacity:1" />
          <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
        </radialGradient>
      </defs>
      <circle cx="20" cy="20" r="18" fill="url(#grad4)" />
      <polygon points="20,8 24,16 32,16 26,22 28,30 20,26 12,30 14,22 8,16 16,16" fill="#ffffff" />
    </svg>
  </div>
</body>
</html>


